<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to jsdmstan ‚Ä¢ jsdmstan</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Montserrat-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to jsdmstan">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">jsdmstan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/jsdmstan.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to jsdmstan</h1>
            
      

      <div class="d-none name"><code>jsdmstan.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nerc-ceh.github.io/jsdmstan/">jsdmstan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8264372</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="joint-species-distribution-models">Joint Species Distribution Models<a class="anchor" aria-label="anchor" href="#joint-species-distribution-models"></a>
</h2>
<p>Joint Species Distibution Models, or jSDMs, are models that model an
entire community of species simultaneously. The idea behind these is
that they allow information to be borrowed across species, such that the
covariance between species can be used to inform the predictions of
distributions of related or commonly co-occurring species.</p>
<p>In plain language (or as plain as I can manage) jSDMs involve the
modelling of an entire species community as a function of some
combination of intercepts, covariate data and species covariance.
Therefore the change of a single species is related to not only change
in the environment but also how it relates to other species. There are
several decisions to be made in how to specify these models - the
standard decisions on which covariates to include, whether each species
should have its own intercept (generally yes) and how to represent
change across sites - but also how to represent the covariance between
species. There are two options for representing this species covariance
in this package. First, the original way of running jSDMs was to model
the entire covariance matrix between species in a multivariate
generalised linear mixed model (MGLMM). However, more recently there
have been methods developed that involve representing the covariance
matrix with a set of linear latent variables - known as generalised
linear latent variable models (GLLVM).</p>
<p>The jsdmstan package aims to provide an interface for fitting these
models in <a href="https://mc-stan.org/" class="external-link">Stan</a> using the Stan
Hamiltonian Monte Carlo sampling as a robust Bayesian methodology.</p>
<div class="section level3">
<h3 id="underlying-maths">Underlying maths<a class="anchor" aria-label="anchor" href="#underlying-maths"></a>
</h3>
<p>Feel free to skip this bit if you don‚Äôt want to read equations, it is
largely based on Warton et al.¬†(<a href="http:://doi.org/10.1016/j.tree.2015.09.007">2015</a>). We model
the community data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">m_{ij}</annotation></semantics></math>
for each site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and taxon
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
as a function of a species intercept, environmental covariates and
species covariance matrix:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><msubsup><mi>ùê±</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><msub><mi>Œ≤</mi><mi>j</mi></msub><mo>+</mo><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> g(m_{ij}) = \beta_{0j} + \mathbf{x}_i^\intercal\beta_j + u_{ij} </annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>
is the link function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>ùê±</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><annotation encoding="application/x-tex">\mathbf{x}_i^\intercal</annotation></semantics></math>
is the transpose of vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùê±</mi><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math>,
and for each taxon
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{0j}</annotation></semantics></math>
is an intercept and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>e</mi><mi>t</mi><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">beta_j</annotation></semantics></math>
is a vector of regression coefficients related to measured
predictors.</p>
<p>A site effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ±</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_{i}</annotation></semantics></math>
can also be added to adjust for total abundance or richness:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œ±</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><msubsup><mi>ùê±</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><msub><mi>Œ≤</mi><mi>j</mi></msub><mo>+</mo><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> g(m_{ij}) = \alpha_{i} + \beta_{0j} + \mathbf{x}_i^\intercal\beta_j + u_{ij} </annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="multivariate-generalised-linear-mixed-models">Multivariate Generalised Linear Mixed Models<a class="anchor" aria-label="anchor" href="#multivariate-generalised-linear-mixed-models"></a>
</h3>
<p>The entire matrix of covariance between species is modelled in
MGLMMs.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àº</mo><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><mi>ùö∫</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> u_{ij} \sim \mathrm{N}(\mathbf{0},\mathbf{\Sigma}) </annotation></semantics></math></p>
<p>Fitting the entire covariance matrix means that the amount of time
required to fit these models scales with the number of species cubed,
and the data required scales with the number of species squared. This
makes these models both computationally and data intensive.</p>
</div>
<div class="section level3">
<h3 id="generalised-linear-latent-variable-models">Generalised Linear Latent Variable Models<a class="anchor" aria-label="anchor" href="#generalised-linear-latent-variable-models"></a>
</h3>
<p>In response to some of these issues in fitting MGLMMs, GLLVMs were
developed in which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">u_{ij}</annotation></semantics></math>
is now specified as a linear function of a set of latent variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><annotation encoding="application/x-tex">\mathbf{z_i}</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ùêÆ</mi><mi>i</mi></msub><mo>‚àº</mo><mi mathvariant="normal">F</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>œï</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> y_{ij}|\mathbf{u}_i \sim \mathrm{F}(m_{ij},\phi_j) </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msubsup><mi>ùê≥</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><msub><mi>Œª</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex"> u_{ij} = \mathbf{z}_i^\intercal \lambda_j </annotation></semantics></math></p>
<p>The latent variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><annotation encoding="application/x-tex">\mathbf{z_i}</annotation></semantics></math>
are treated as random by assuming:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><mo>‚àº</mo><mi mathvariant="normal">F</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>œï</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">y_{ij}|\mathbf{z_i} \sim \mathrm{F}(m_{ij},\phi_j)) </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><mo>‚àº</mo><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><mn>ùüè</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{z_i} \sim \mathrm{N}(\mathbf{0},\mathbf{1}) </annotation></semantics></math>
Treating the species covariance as pulling from a set of latent
variables greatly reduces the computational time required to fit these
models.</p>
</div>
<div class="section level3">
<h3 id="relationship-to-environmental-covariates">Relationship to environmental covariates<a class="anchor" aria-label="anchor" href="#relationship-to-environmental-covariates"></a>
</h3>
<p>Within jsdmstan the response of species to environmental covariates
can either be unstructured (the default) or constrained by a covariance
matrix between the environmental covariates. This second option
(specified by setting <code>beta_param = "cor"</code>) assumes that if
one species is strongly positively related to multiple covariates then
it is more likely that other species will either also be positively
related to all these covariates, or negatively related. Mathematically
this corresponds to:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mi>j</mi></msub><mo>‚àº</mo><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><mi>ùö∫</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_j \sim \mathrm{N}(\mathbf{0},\mathbf{\Sigma})</annotation></semantics></math></p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-a-mglmm">Fitting a MGLMM<a class="anchor" aria-label="anchor" href="#fitting-a-mglmm"></a>
</h2>
<p>First we can use the in-built functions for simulating data according
to the MGLMM model - we‚Äôll choose to simulate 15 species over 200 sites
with 2 environmental covariates. The species are assumed to follow a
Poisson distribution (with a log-link), and we use the defaults of
including a species-specific intercept but no site-specific intercept.
At the moment only default priors (standard normal distribution) are
supported. We can do this using either the <code><a href="../reference/jsdm_sim_data.html">jsdm_sim_data()</a></code>
function with <code>method = "mglmm"</code> or with the
<code><a href="../reference/jsdm_sim_data.html">mglmm_sim_data()</a></code> function which just calls
<code><a href="../reference/jsdm_sim_data.html">jsdm_sim_data()</a></code> in the background.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nsites</span> <span class="op">&lt;-</span> <span class="fl">75</span></span>
<span><span class="va">nspecies</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">ncovar</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">mglmm_test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jsdm_sim_data.html">mglmm_sim_data</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">nsites</span>, S <span class="op">=</span> <span class="va">nspecies</span>, </span>
<span>                                  K <span class="op">=</span> <span class="va">ncovar</span>, family <span class="op">=</span> <span class="st">"pois"</span><span class="op">)</span></span></code></pre></div>
<p>This returns a list, which includes the Y matrix, the X matrix, plus
also the exact parameters used to create the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Y"    "pars" "N"    "S"    "D"    "K"    "X"</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<p>Now, to fit the model we can use the <code><a href="../reference/stan_jsdm.html">stan_jsdm()</a></code>
function, which interfaces to Stan through the <a href="https://mc-stan.org/rstan/" class="external-link">rstan package</a>. There are multiple
ways to supply data to the <code><a href="../reference/stan_jsdm.html">stan_jsdm()</a></code> function, one is to
supply the data as a list with the appropriate named components (the
<code><a href="../reference/jsdm_sim_data.html">jsdm_sim_data()</a></code> functions supply data in the correct format
already), the second way is to specify the Y and X matrices directly,
and the third way is to use a formula for the environmental covariates
and supply the environmental data to the <code>data</code> argument,
which is what we‚Äôll use here:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mglmm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_jsdm.html">stan_jsdm</a></span><span class="op">(</span><span class="op">~</span> <span class="va">V1</span> <span class="op">+</span> <span class="va">V2</span>, data <span class="op">=</span> <span class="va">dat</span>, Y <span class="op">=</span> <span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">Y</span>, </span>
<span>                       family <span class="op">=</span> <span class="st">"pois"</span>, method <span class="op">=</span> <span class="st">"mglmm"</span>, refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                       log_lik <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>If we print the model object we will get a brief overview of the type
of jSDM and the data, plus if there are any parameters with Rhat &gt;
1.01 or effective sample size ratio (Neff/N) &lt; 0.05 then they will be
printed:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mglmm_fit</span></span>
<span><span class="co">#&gt; Family: poisson </span></span>
<span><span class="co">#&gt;  Model type: mglmm</span></span>
<span><span class="co">#&gt;   Number of species: 8</span></span>
<span><span class="co">#&gt;   Number of sites: 75</span></span>
<span><span class="co">#&gt;   Number of predictors: 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model run on 4 chains with 4000 iterations per chain (2000 warmup).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No parameters with Rhat &gt; 1.01 or Neff/N &lt; 0.05</span></span></code></pre></div>
<p>To get a summary of all the model parameters we can use
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, there are many parameters in these models so we
just include a few here:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, pars <span class="op">=</span> <span class="st">"cor_species"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    mean    sd    15%    85%  Rhat Bulk.ESS Tail.ESS</span></span>
<span><span class="co">#&gt; cor_species[2,1]  0.109 0.229 -0.127  0.342 1.006     1363     2287</span></span>
<span><span class="co">#&gt; cor_species[3,1] -0.228 0.155 -0.387 -0.067 1.001     2214     4439</span></span>
<span><span class="co">#&gt; cor_species[4,1]  0.459 0.098  0.358  0.561 1.001     3219     5068</span></span>
<span><span class="co">#&gt; cor_species[5,1] -0.178 0.186 -0.373  0.018 1.001     2149     3974</span></span>
<span><span class="co">#&gt; cor_species[6,1]  0.041 0.141 -0.105  0.187 1.000     3004     4523</span></span>
<span><span class="co">#&gt; cor_species[7,1] -0.106 0.301 -0.425  0.218 1.004      828     1886</span></span>
<span><span class="co">#&gt; cor_species[8,1] -0.060 0.291 -0.360  0.245 1.003     1008     2460</span></span>
<span><span class="co">#&gt; cor_species[1,2]  0.109 0.229 -0.127  0.342 1.006     1363     2287</span></span>
<span><span class="co">#&gt; cor_species[2,2]  1.000 0.000  1.000  1.000 1.000     8020       NA</span></span>
<span><span class="co">#&gt; cor_species[3,2]  0.051 0.262 -0.227  0.324 1.000     3115     4368</span></span>
<span><span class="co">#&gt; cor_species[4,2]  0.380 0.238  0.160  0.611 1.002     1507     1273</span></span>
<span><span class="co">#&gt; cor_species[5,2] -0.128 0.282 -0.427  0.174 1.000     2876     4073</span></span>
<span><span class="co">#&gt; cor_species[6,2] -0.103 0.276 -0.391  0.186 1.001     2090     3170</span></span>
<span><span class="co">#&gt; cor_species[7,2]  0.007 0.312 -0.329  0.346 1.001     3291     4744</span></span>
<span><span class="co">#&gt; cor_species[8,2] -0.071 0.317 -0.415  0.274 1.001     3362     4480</span></span>
<span><span class="co">#&gt; cor_species[1,3] -0.228 0.155 -0.387 -0.067 1.001     2214     4439</span></span>
<span><span class="co">#&gt; cor_species[2,3]  0.051 0.262 -0.227  0.324 1.000     3115     4368</span></span>
<span><span class="co">#&gt; cor_species[3,3]  1.000 0.000  1.000  1.000 1.000     7674       NA</span></span>
<span><span class="co">#&gt; cor_species[4,3] -0.166 0.154 -0.328 -0.001 1.001     3280     5434</span></span>
<span><span class="co">#&gt; cor_species[5,3]  0.223 0.273 -0.064  0.514 1.001     2422     4677</span></span>
<span><span class="co">#&gt; cor_species[6,3]  0.142 0.231 -0.098  0.381 1.001     2462     4156</span></span>
<span><span class="co">#&gt; cor_species[7,3]  0.044 0.308 -0.290  0.374 1.001     2721     5061</span></span>
<span><span class="co">#&gt; cor_species[8,3]  0.037 0.309 -0.297  0.378 1.000     2689     4858</span></span>
<span><span class="co">#&gt; cor_species[1,4]  0.459 0.098  0.358  0.561 1.001     3219     5068</span></span>
<span><span class="co">#&gt; cor_species[2,4]  0.380 0.238  0.160  0.611 1.002     1507     1273</span></span>
<span><span class="co">#&gt; cor_species[3,4] -0.166 0.154 -0.328 -0.001 1.001     3280     5434</span></span>
<span><span class="co">#&gt; cor_species[4,4]  1.000 0.000  1.000  1.000 1.000     7564     7769</span></span>
<span><span class="co">#&gt; cor_species[5,4] -0.312 0.193 -0.520 -0.112 1.001     2634     3994</span></span>
<span><span class="co">#&gt; cor_species[6,4] -0.190 0.137 -0.332 -0.048 1.000     4303     5859</span></span>
<span><span class="co">#&gt; cor_species[7,4]  0.015 0.294 -0.291  0.323 1.001     1293     2811</span></span>
<span><span class="co">#&gt; cor_species[8,4] -0.124 0.300 -0.440  0.191 1.003     1129     2210</span></span>
<span><span class="co">#&gt; cor_species[1,5] -0.178 0.186 -0.373  0.018 1.001     2149     3974</span></span>
<span><span class="co">#&gt; cor_species[2,5] -0.128 0.282 -0.427  0.174 1.000     2876     4073</span></span>
<span><span class="co">#&gt; cor_species[3,5]  0.223 0.273 -0.064  0.514 1.001     2422     4677</span></span>
<span><span class="co">#&gt; cor_species[4,5] -0.312 0.193 -0.520 -0.112 1.001     2634     3994</span></span>
<span><span class="co">#&gt; cor_species[5,5]  1.000 0.000  1.000  1.000 1.000     7879     7793</span></span>
<span><span class="co">#&gt; cor_species[6,5]  0.378 0.194  0.175  0.580 1.000     4031     6063</span></span>
<span><span class="co">#&gt; cor_species[7,5] -0.029 0.305 -0.358  0.294 1.001     2703     4902</span></span>
<span><span class="co">#&gt; cor_species[8,5]  0.095 0.301 -0.230  0.415 1.000     2933     5281</span></span>
<span><span class="co">#&gt; cor_species[1,6]  0.041 0.141 -0.105  0.187 1.000     3004     4523</span></span>
<span><span class="co">#&gt; cor_species[2,6] -0.103 0.276 -0.391  0.186 1.001     2090     3170</span></span>
<span><span class="co">#&gt; cor_species[3,6]  0.142 0.231 -0.098  0.381 1.001     2462     4156</span></span>
<span><span class="co">#&gt; cor_species[4,6] -0.190 0.137 -0.332 -0.048 1.000     4303     5859</span></span>
<span><span class="co">#&gt; cor_species[5,6]  0.378 0.194  0.175  0.580 1.000     4031     6063</span></span>
<span><span class="co">#&gt; cor_species[6,6]  1.000 0.000  1.000  1.000 1.000     7731     7535</span></span>
<span><span class="co">#&gt; cor_species[7,6]  0.037 0.311 -0.300  0.373 1.001     2136     4447</span></span>
<span><span class="co">#&gt; cor_species[8,6]  0.140 0.295 -0.180  0.449 1.000     2548     3928</span></span>
<span><span class="co">#&gt; cor_species[1,7] -0.106 0.301 -0.425  0.218 1.004      828     1886</span></span>
<span><span class="co">#&gt; cor_species[2,7]  0.007 0.312 -0.329  0.346 1.001     3291     4744</span></span>
<span><span class="co">#&gt; cor_species[3,7]  0.044 0.308 -0.290  0.374 1.001     2721     5061</span></span>
<span><span class="co">#&gt; cor_species[4,7]  0.015 0.294 -0.291  0.323 1.001     1293     2811</span></span>
<span><span class="co">#&gt; cor_species[5,7] -0.029 0.305 -0.358  0.294 1.001     2703     4902</span></span>
<span><span class="co">#&gt; cor_species[6,7]  0.037 0.311 -0.300  0.373 1.001     2136     4447</span></span>
<span><span class="co">#&gt; cor_species[7,7]  1.000 0.000  1.000  1.000 1.001     7609     7576</span></span>
<span><span class="co">#&gt; cor_species[8,7]  0.006 0.318 -0.335  0.354 1.000     5263     6556</span></span>
<span><span class="co">#&gt; cor_species[1,8] -0.060 0.291 -0.360  0.245 1.003     1008     2460</span></span>
<span><span class="co">#&gt; cor_species[2,8] -0.071 0.317 -0.415  0.274 1.001     3362     4480</span></span>
<span><span class="co">#&gt; cor_species[3,8]  0.037 0.309 -0.297  0.378 1.000     2689     4858</span></span>
<span><span class="co">#&gt; cor_species[4,8] -0.124 0.300 -0.440  0.191 1.003     1129     2210</span></span>
<span><span class="co">#&gt; cor_species[5,8]  0.095 0.301 -0.230  0.415 1.000     2933     5281</span></span>
<span><span class="co">#&gt; cor_species[6,8]  0.140 0.295 -0.180  0.449 1.000     2548     3928</span></span>
<span><span class="co">#&gt; cor_species[7,8]  0.006 0.318 -0.335  0.354 1.000     5263     6556</span></span>
<span><span class="co">#&gt; cor_species[8,8]  1.000 0.000  1.000  1.000 1.000     8231     8024</span></span></code></pre></div>
<p>To get a better overview of the R-hat and effective sample size we
can use the <code><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot()</a></code> function to plot histograms of
R-hat and ESS.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"rhat_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"neff_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>We can also examine the output for each parameter visually using a
traceplot combined with a density plot, which is given by the default
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> command:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="jsdmstan_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="jsdmstan_files/figure-html/unnamed-chunk-9-3.png" width="700"><img src="jsdmstan_files/figure-html/unnamed-chunk-9-4.png" width="700"></p>
<p>By default the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> command plots all of the
parameters with sigma or kappa in their name plus a random selection of
20 other parameters, but this can be overridden by either specifying the
parameters by name (with or without regular expression matching) or
changing the number of parameters to be randomly sampled. Use the
<code><a href="../reference/jsdmstan-extractors.html">get_parnames()</a></code> function to get the names of parameters
within a model - and the <code><a href="../reference/jsdm_stancode.html">jsdm_stancode()</a></code> function can also
be used to see the underlying structure of the model.</p>
<p>All the mcmc plot types within bayesplot are supported by the
<code><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot()</a></code> function, and to see a full list either use
<code><a href="https://mc-stan.org/bayesplot/reference/available_ppc.html" class="external-link">bayesplot::available_mcmc()</a></code> or run <code><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot()</a></code>
with an incorrect type and the options will be printed.</p>
<p>We can also view the environmental effect parameters for each species
using the <code><a href="../reference/envplot.html">envplot()</a></code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/envplot.html">envplot</a></span><span class="op">(</span><span class="va">mglmm_fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Posterior predictions can be extracted from the models using either
<code><a href="../reference/posterior_linpred.jsdmStanFit.html">posterior_linpred()</a></code> or <code><a href="../reference/posterior_predict.jsdmStanFit.html">posterior_predict()</a></code>,
where the linpred function extracts the linear predictor for the
community composition within each draw and the predict function combines
this linear predictor extraction with a random generation based on the
predicted probability for the family. Both functions by default return a
list of length equal to the number of draws extracted, where each
element of the list is a sites by species matrix.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mglmm_pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_predict.jsdmStanFit.html">posterior_predict</a></span><span class="op">(</span><span class="va">mglmm_fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mglmm_pp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mglmm_pp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 75  8</span></span></code></pre></div>
<p>As well as the MCMC plotting functions within bayesplot the ppc_
family of functions is also supported through the
<code><a href="../reference/pp_check.jsdmStanFit.html">pp_check()</a></code> function. This family of functions provides a
graphical way to check your posterior against the data used within the
model to evaluate model fit - called a posterior retrodictive check (or
posterior predictive historically and when the prior only has been
sampled from). To use these you need to have set
<code>save_data = TRUE</code> within the <code><a href="../reference/stan_jsdm.html">stan_jsdm()</a></code> call.
Unlike in other packages by default <code><a href="../reference/pp_check.jsdmStanFit.html">pp_check()</a></code> for
<code>jsdmStanFit</code> objects extracts the posterior predictions then
calculates summary statistics over the rows and plots those summary
statistics against the same for the original data. The default behaviour
is to calculate the sum of all the species per site - i.e.¬†total
abundance.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.jsdmStanFit.html">pp_check</a></span><span class="op">(</span><span class="va">mglmm_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 10 posterior draws for ppc plot type 'ppc_dens_overlay' by default.</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>The summary statistic can be changed, as can whether it is calculated
for every species or every site:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.jsdmStanFit.html">pp_check</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, summary_stat <span class="op">=</span> <span class="st">"mean"</span>, calc_over <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>         plotfun <span class="op">=</span> <span class="st">"ecdf_overlay"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 10 posterior draws for ppc plot type 'ppc_ecdf_overlay' by default.</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We can examine the species-specific posterior predictive check
through using <code><a href="../reference/multi_pp_check.html">multi_pp_check()</a></code>, or examine how well the
relationships between specific species are recovered using
<code><a href="../reference/pp_check.jsdmStanFit.html">pp_check()</a></code> with <code>plotfun = "pairs"</code>.</p>
<p>As we have run the above model on simulated data and the original
data list contains the parameters used to simulate the data we can use
the <code>mcmc_recover_</code> functions from <code>bayesplot</code> to
see how the model did:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"recover_hist"</span>,</span>
<span>          pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sigmas_species["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,<span class="st">"]"</span><span class="op">)</span>,</span>
<span>          true <span class="op">=</span> <span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">pars</span><span class="op">$</span><span class="va">sigmas_species</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"recover_intervals"</span>,</span>
<span>          pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cor_species["</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nspecies</span>, <span class="va">nspecies</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,<span class="st">","</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, <span class="st">":"</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span>,</span>
<span>          true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">pars</span><span class="op">$</span><span class="va">cor_species</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">pars</span><span class="op">$</span><span class="va">cor_species</span>, diag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="fitting-a-gllvm">Fitting a GLLVM<a class="anchor" aria-label="anchor" href="#fitting-a-gllvm"></a>
</h2>
<p>The model fitting workflow for latent variable models is very similar
to that above, with the addition of specifying the number of latent
variables (D) in the data simulation and model fit. Here we change the
family to a Bernoulli family (i.e.¬†the special case of the binomial
where the number of trials is 1 for all observations), make the
covariate effects on each species draw from a correlation matrix such
that information can be shared across species, and change the prior to
be a Student‚Äôs T prior on the predictor-specific sigma parameter.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3562251</span><span class="op">)</span></span>
<span><span class="va">gllvm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jsdm_sim_data.html">gllvm_sim_data</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">50</span>, S <span class="op">=</span> <span class="fl">12</span>, D <span class="op">=</span> <span class="fl">2</span>, K <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             family <span class="op">=</span> <span class="st">"bernoulli"</span>,</span>
<span>                             beta_param <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>                             prior <span class="op">=</span> <span class="fu"><a href="../reference/jsdm_prior.html">jsdm_prior</a></span><span class="op">(</span>sigmas_preds <span class="op">=</span> <span class="st">"student_t(3,0,1)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gllvm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_jsdm.html">stan_jsdm</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">gllvm_data</span><span class="op">$</span><span class="va">Y</span>, X <span class="op">=</span> <span class="va">gllvm_data</span><span class="op">$</span><span class="va">X</span>,</span>
<span>                       D <span class="op">=</span> <span class="va">gllvm_data</span><span class="op">$</span><span class="va">D</span>,  </span>
<span>                       family <span class="op">=</span> <span class="st">"bernoulli"</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"gllvm"</span>, </span>
<span>                       beta_param <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>                       prior <span class="op">=</span> <span class="fu"><a href="../reference/jsdm_prior.html">jsdm_prior</a></span><span class="op">(</span>sigmas_preds <span class="op">=</span> <span class="st">"student_t(3,0,1)"</span><span class="op">)</span>,</span>
<span>                       refresh <span class="op">=</span> <span class="fl">0</span>, log_lik <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">gllvm_fit</span></span>
<span><span class="co">#&gt; Family: bernoulli </span></span>
<span><span class="co">#&gt;  Model type: gllvm with 2 latent variables</span></span>
<span><span class="co">#&gt;   Number of species: 12</span></span>
<span><span class="co">#&gt;   Number of sites: 50</span></span>
<span><span class="co">#&gt;   Number of predictors: 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model run on 4 chains with 4000 iterations per chain (2000 warmup).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No parameters with Rhat &gt; 1.01 or Neff/N &lt; 0.05</span></span></code></pre></div>
<p>Again, the diagnostic statistics seem reasonable:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">gllvm_fit</span>, plotfun <span class="op">=</span> <span class="st">"rhat_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Dropped 1 NAs from 'new_rhat(rhat)'.</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">gllvm_fit</span>, plotfun <span class="op">=</span> <span class="st">"neff_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>For brevity‚Äôs sake we will not go into the detail of the different
functions again here, however there is one plotting function
specifically for GLLVM models - <code><a href="../reference/ordiplot.html">ordiplot()</a></code>. This plots the
species or sites scores against the latent variables from a random
selection of draws:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">gllvm_fit</span>, errorbar_range <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">gllvm_fit</span>, type <span class="op">=</span> <span class="st">"sites"</span>, geom <span class="op">=</span> <span class="st">"text"</span>, errorbar_range <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>You can change the latent variables selected by specifying the
<code>choices</code> argument, and alter the number of draws or whether
you want to plot species or sites with the other arguments.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Warton et al (2015) So many variables: joint modeling in community
ecology. Trends in Ecology &amp; Evolution, 30:766-779. DOI: <a href="http:://doi.org/10.1016/j.tree.2015.09.007">10.1016/j.tree.2015.09.007</a>.</p>
<p>Wilkinson et al (2021) Defining and evaluating predictions of joint
species distribution models. Methods in Ecology and Evolution,
12:394-404. DOI: <a href="http:://doi.org/10.1111/2041-210X.13518">10.1111/2041-210X.13518</a>.</p>
<p>Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical Bayesian
model evaluation using leave-one-out cross-validation and WAIC.
Statistics and Computing. 27(5), 1413‚Äì1432. DOI: <a href="http::doi.org/10.1007/s11222-016-9696-4">10.1007/s11222-016-9696-4</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fiona Seaton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
