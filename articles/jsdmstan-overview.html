<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Overview ‚Ä¢ jsdmstan</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Montserrat-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Overview">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">jsdmstan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/jsdmstan-overview.html">Overview</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Overview</h1>
            
      

      <div class="d-none name"><code>jsdmstan-overview.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nerc-ceh.github.io/jsdmstan/">jsdmstan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8264372</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="joint-species-distribution-models">Joint Species Distribution Models<a class="anchor" aria-label="anchor" href="#joint-species-distribution-models"></a>
</h2>
<p>Joint Species Distibution Models, or jSDMs, are models that model an
entire community of species simultaneously. The idea behind these is
that they allow information to be borrowed across species, such that the
covariance between species can be used to inform the predictions of
distributions of related or commonly co-occurring species.</p>
<p>In plain language (or as plain as I can manage) jSDMs involve the
modelling of an entire species community as a function of some
combination of intercepts, covariate data and species covariance.
Therefore the change of a single species is related to not only change
in the environment but also how it relates to other species. There are
several decisions to be made in how to specify these models - the
standard decisions on which covariates to include, whether each species
should have its own intercept (generally yes) and how to represent
change across sites - but also how to represent the covariance between
species. There are two options for representing this species covariance
in this package. First, the original way of running jSDMs was to model
the entire covariance matrix between species in a multivariate
generalised linear mixed model (MGLMM). However, more recently there
have been methods developed that involve representing the covariance
matrix with a set of linear latent variables - known as generalised
linear latent variable models (GLLVM).</p>
<p>The jsdmstan package aims to provide an interface for fitting these
models in <a href="https://mc-stan.org/" class="external-link">Stan</a> using the Stan
Hamiltonian Monte Carlo sampling as a robust Bayesian methodology.</p>
<div class="section level3">
<h3 id="underlying-maths">Underlying maths<a class="anchor" aria-label="anchor" href="#underlying-maths"></a>
</h3>
<p>Feel free to skip this bit if you don‚Äôt want to read equations, it is
largely based on Warton et al.¬†(<a href="http:://doi.org/10.1016/j.tree.2015.09.007">2015</a>). We model
the community data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">m_{ij}</annotation></semantics></math>
for each site
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and taxon
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
as a function of a species intercept, environmental covariates and
species covariance matrix:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><msubsup><mi>ùê±</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><msub><mi>Œ≤</mi><mi>j</mi></msub><mo>+</mo><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> g(m_{ij}) = \beta_{0j} + \mathbf{x}_i^\intercal\beta_j + u_{ij} </annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>
is the link function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>ùê±</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><annotation encoding="application/x-tex">\mathbf{x}_i^\intercal</annotation></semantics></math>
is the transpose of vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùê±</mi><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math>,
and for each taxon
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{0j}</annotation></semantics></math>
is an intercept and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>e</mi><mi>t</mi><msub><mi>a</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">beta_j</annotation></semantics></math>
is a vector of regression coefficients related to measured
predictors.</p>
<p>A site effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ±</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_{i}</annotation></semantics></math>
can also be added to adjust for total abundance or richness:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œ±</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><msubsup><mi>ùê±</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><msub><mi>Œ≤</mi><mi>j</mi></msub><mo>+</mo><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex"> g(m_{ij}) = \alpha_{i} + \beta_{0j} + \mathbf{x}_i^\intercal\beta_j + u_{ij} </annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="multivariate-generalised-linear-mixed-models">Multivariate Generalised Linear Mixed Models<a class="anchor" aria-label="anchor" href="#multivariate-generalised-linear-mixed-models"></a>
</h3>
<p>The entire matrix of covariance between species is modelled in
MGLMMs.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àº</mo><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><mi>ùö∫</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> u_{ij} \sim \mathrm{N}(\mathbf{0},\mathbf{\Sigma}) </annotation></semantics></math></p>
<p>Fitting the entire covariance matrix means that the amount of time
required to fit these models scales with the number of species cubed,
and the data required scales with the number of species squared. This
makes these models both computationally and data intensive.</p>
</div>
<div class="section level3">
<h3 id="generalised-linear-latent-variable-models">Generalised Linear Latent Variable Models<a class="anchor" aria-label="anchor" href="#generalised-linear-latent-variable-models"></a>
</h3>
<p>In response to some of these issues in fitting MGLMMs, GLLVMs were
developed in which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">u_{ij}</annotation></semantics></math>
is now specified as a linear function of a set of latent variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><annotation encoding="application/x-tex">\mathbf{z_i}</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ùêÆ</mi><mi>i</mi></msub><mo>‚àº</mo><mi mathvariant="normal">F</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>œï</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> y_{ij}|\mathbf{u}_i \sim \mathrm{F}(m_{ij},\phi_j) </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msubsup><mi>ùê≥</mi><mi>i</mi><mo>‚ä∫</mo></msubsup><msub><mi>Œª</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex"> u_{ij} = \mathbf{z}_i^\intercal \lambda_j </annotation></semantics></math></p>
<p>The latent variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><annotation encoding="application/x-tex">\mathbf{z_i}</annotation></semantics></math>
are treated as random by assuming:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><mo>‚àº</mo><mi mathvariant="normal">F</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>œï</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">y_{ij}|\mathbf{z_i} \sim \mathrm{F}(m_{ij},\phi_j)) </annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùê≥</mi><mi>ùê¢</mi></msub><mo>‚àº</mo><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><mn>ùüè</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{z_i} \sim \mathrm{N}(\mathbf{0},\mathbf{1}) </annotation></semantics></math>
Treating the species covariance as pulling from a set of latent
variables greatly reduces the computational time required to fit these
models.</p>
</div>
<div class="section level3">
<h3 id="relationship-to-environmental-covariates">Relationship to environmental covariates<a class="anchor" aria-label="anchor" href="#relationship-to-environmental-covariates"></a>
</h3>
<p>The default approach in jsdmstan is to assume that the response of
species to environmental covariates is constrained by a covariance
matrix between the environmental covariates. This assumes that if one
species is strongly positively related to multiple covariates then it is
more likely that other species will either also be positively related to
all these covariates, or negatively related. Mathematically this maybe
corresponds to:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ≤</mi><mi>j</mi></msub><mo>‚àº</mo><mi mathvariant="normal">N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>ùüé</mn><mo>,</mo><mi>ùö∫</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\beta_j \sim \mathrm{N}(\mathbf{0},\mathbf{\Sigma})</annotation></semantics></math></p>
<p>This default behaviour can be overridden through specifying the
<code>beta_param</code> argument to <code>"unstruct"</code> if you want
the betas to just draw from some distribution set through
<code><a href="../reference/jsdm_prior.html">jsdm_prior()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-a-mglmm">Fitting a MGLMM<a class="anchor" aria-label="anchor" href="#fitting-a-mglmm"></a>
</h2>
<p>First we can use the in-built functions for simulating data according
to the MGLMM model - we‚Äôll choose to simulate 15 species over 200 sites
with 2 environmental covariates. The species are assumed to follow a
Poisson distribution (with a log-link), and we use the defaults of
including a species-specific intercept but no site-specific intercept.
At the moment only default priors (standard normal distribution) are
supported. We can do this using either the <code>jsdm_sim_data</code>
function with <code>method = "mglmm"</code> or with the
<code>mglmm_sim_data</code> function which just calls
<code>jsdm_sim_data</code> in the background.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nsites</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">nspecies</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">ncovar</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">mglmm_test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jsdm_sim_data.html">mglmm_sim_data</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">nsites</span>, S <span class="op">=</span> <span class="va">nspecies</span>, </span>
<span>                                  K <span class="op">=</span> <span class="va">ncovar</span>, family <span class="op">=</span> <span class="st">"pois"</span><span class="op">)</span></span></code></pre></div>
<p>This returns a list, which includes the Y matrix, the X matrix, plus
also the exact parameters used to create the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Y"    "pars" "N"    "S"    "D"    "K"    "X"</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<p>Now, to fit the model we can use the <code>stan_jsdm</code> function,
which interfaces to Stan through the <a href="https://mc-stan.org/rstan/" class="external-link">rstan package</a>. There are two ways
to supply data to the <code>stan_jsdm</code> function, one is to supply
the data as a list with the appropriate named components (the
<code>jsdm_sim_data</code> functions supply data in the correct format
already) and the other is to specify the Y and X matrices directly,
which is what we‚Äôll use here:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mglmm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_jsdm.html">stan_jsdm</a></span><span class="op">(</span><span class="op">~</span> <span class="va">V1</span> <span class="op">+</span> <span class="va">V2</span>, data <span class="op">=</span> <span class="va">dat</span>, Y <span class="op">=</span> <span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">Y</span>, </span>
<span>                       family <span class="op">=</span> <span class="st">"pois"</span>, method <span class="op">=</span> <span class="st">"mglmm"</span>, refresh <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                       log_lik <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trying to compile a simple C file</span></span>
<span><span class="co">#&gt; Running /opt/R/4.4.1/lib/R/bin/R CMD SHLIB foo.c</span></span>
<span><span class="co">#&gt; using C compiler: ‚Äògcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0‚Äô</span></span>
<span><span class="co">#&gt; gcc -I"/opt/R/4.4.1/lib/R/include" -DNDEBUG   -I"/home/runner/work/_temp/Library/Rcpp/include/"  -I"/home/runner/work/_temp/Library/RcppEigen/include/"  -I"/home/runner/work/_temp/Library/RcppEigen/include/unsupported"  -I"/home/runner/work/_temp/Library/BH/include" -I"/home/runner/work/_temp/Library/StanHeaders/include/src/"  -I"/home/runner/work/_temp/Library/StanHeaders/include/"  -I"/home/runner/work/_temp/Library/RcppParallel/include/"  -I"/home/runner/work/_temp/Library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/home/runner/work/_temp/Library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include    -fpic  -g -O2  -c foo.c -o foo.o</span></span>
<span><span class="co">#&gt; In file included from /home/runner/work/_temp/Library/RcppEigen/include/Eigen/Core:19,</span></span>
<span><span class="co">#&gt;                  from /home/runner/work/_temp/Library/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/runner/work/_temp/Library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/runner/work/_temp/Library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: cmath: No such file or directory</span></span>
<span><span class="co">#&gt;   679 | #include &lt;cmath&gt;</span></span>
<span><span class="co">#&gt;       |          ^~~~~~~</span></span>
<span><span class="co">#&gt; compilation terminated.</span></span>
<span><span class="co">#&gt; make: *** [/opt/R/4.4.1/lib/R/etc/Makeconf:195: foo.o] Error 1</span></span></code></pre></div>
<p>If we print the model object we will get a brief overview of the type
of jSDM and the data, plus if there are any parameters with Rhat &gt;
1.01 or effective sample size ratio (Neff/N) &lt; 0.05 then they will be
printed:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mglmm_fit</span></span>
<span><span class="co">#&gt; Family: poisson </span></span>
<span><span class="co">#&gt;  Model type: mglmm</span></span>
<span><span class="co">#&gt;   Number of species: 8</span></span>
<span><span class="co">#&gt;   Number of sites: 60</span></span>
<span><span class="co">#&gt;   Number of predictors: 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model run on 4 chains with 4000 iterations per chain (2000 warmup).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No parameters with Rhat &gt; 1.01 or Neff/N &lt; 0.05</span></span></code></pre></div>
<p>To get a summary of all the model parameters we can use
<code>summary</code>, there are many parameters in these models so we
just include a few here:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, pars <span class="op">=</span> <span class="st">"cor_species"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    mean    sd    15%    85%  Rhat Bulk.ESS Tail.ESS</span></span>
<span><span class="co">#&gt; cor_species[2,1]  0.028 0.281 -0.262  0.316 1.002     1221     2374</span></span>
<span><span class="co">#&gt; cor_species[3,1]  0.009 0.176 -0.174  0.191 1.001     2564     4131</span></span>
<span><span class="co">#&gt; cor_species[4,1]  0.242 0.177  0.059  0.425 1.000     2450     3337</span></span>
<span><span class="co">#&gt; cor_species[5,1]  0.086 0.117 -0.036  0.206 1.002     3793     5314</span></span>
<span><span class="co">#&gt; cor_species[6,1] -0.132 0.181 -0.316  0.055 1.001     2838     3688</span></span>
<span><span class="co">#&gt; cor_species[7,1] -0.181 0.136 -0.322 -0.039 1.001     2940     4948</span></span>
<span><span class="co">#&gt; cor_species[8,1] -0.271 0.247 -0.527 -0.008 1.005     1311     1838</span></span>
<span><span class="co">#&gt; cor_species[1,2]  0.028 0.281 -0.262  0.316 1.002     1221     2374</span></span>
<span><span class="co">#&gt; cor_species[2,2]  1.000 0.000  1.000  1.000 1.001     8037       NA</span></span>
<span><span class="co">#&gt; cor_species[3,2]  0.036 0.269 -0.240  0.313 1.004     1567     2215</span></span>
<span><span class="co">#&gt; cor_species[4,2] -0.259 0.293 -0.555  0.058 1.003     1618     2235</span></span>
<span><span class="co">#&gt; cor_species[5,2]  0.089 0.262 -0.178  0.362 1.004     1125     1892</span></span>
<span><span class="co">#&gt; cor_species[6,2]  0.008 0.278 -0.281  0.299 1.004     1882     2755</span></span>
<span><span class="co">#&gt; cor_species[7,2]  0.108 0.270 -0.166  0.388 1.006     1075     1563</span></span>
<span><span class="co">#&gt; cor_species[8,2]  0.023 0.296 -0.292  0.342 1.001     2945     4908</span></span>
<span><span class="co">#&gt; cor_species[1,3]  0.009 0.176 -0.174  0.191 1.001     2564     4131</span></span>
<span><span class="co">#&gt; cor_species[2,3]  0.036 0.269 -0.240  0.313 1.004     1567     2215</span></span>
<span><span class="co">#&gt; cor_species[3,3]  1.000 0.000  1.000  1.000 1.000     7792       NA</span></span>
<span><span class="co">#&gt; cor_species[4,3]  0.036 0.178 -0.152  0.221 1.000     3636     5383</span></span>
<span><span class="co">#&gt; cor_species[5,3]  0.455 0.143  0.304  0.605 1.001     3358     5112</span></span>
<span><span class="co">#&gt; cor_species[6,3]  0.482 0.180  0.293  0.674 1.000     4327     5676</span></span>
<span><span class="co">#&gt; cor_species[7,3] -0.274 0.148 -0.430 -0.120 1.001     3222     5105</span></span>
<span><span class="co">#&gt; cor_species[8,3]  0.285 0.230  0.055  0.525 1.000     2342     2024</span></span>
<span><span class="co">#&gt; cor_species[1,4]  0.242 0.177  0.059  0.425 1.000     2450     3337</span></span>
<span><span class="co">#&gt; cor_species[2,4] -0.259 0.293 -0.555  0.058 1.003     1618     2235</span></span>
<span><span class="co">#&gt; cor_species[3,4]  0.036 0.178 -0.152  0.221 1.000     3636     5383</span></span>
<span><span class="co">#&gt; cor_species[4,4]  1.000 0.000  1.000  1.000 1.000     8026     6853</span></span>
<span><span class="co">#&gt; cor_species[5,4] -0.198 0.171 -0.375 -0.021 1.001     2381     4381</span></span>
<span><span class="co">#&gt; cor_species[6,4] -0.122 0.195 -0.326  0.083 1.000     4415     5681</span></span>
<span><span class="co">#&gt; cor_species[7,4] -0.191 0.165 -0.361 -0.019 1.001     3249     5112</span></span>
<span><span class="co">#&gt; cor_species[8,4] -0.164 0.243 -0.415  0.085 1.000     3072     2679</span></span>
<span><span class="co">#&gt; cor_species[1,5]  0.086 0.117 -0.036  0.206 1.002     3793     5314</span></span>
<span><span class="co">#&gt; cor_species[2,5]  0.089 0.262 -0.178  0.362 1.004     1125     1892</span></span>
<span><span class="co">#&gt; cor_species[3,5]  0.455 0.143  0.304  0.605 1.001     3358     5112</span></span>
<span><span class="co">#&gt; cor_species[4,5] -0.198 0.171 -0.375 -0.021 1.001     2381     4381</span></span>
<span><span class="co">#&gt; cor_species[5,5]  1.000 0.000  1.000  1.000 1.000     6756     7552</span></span>
<span><span class="co">#&gt; cor_species[6,5]  0.215 0.175  0.037  0.398 1.000     3173     4339</span></span>
<span><span class="co">#&gt; cor_species[7,5]  0.178 0.118  0.058  0.300 1.000     3952     5534</span></span>
<span><span class="co">#&gt; cor_species[8,5]  0.217 0.233 -0.014  0.459 1.002     1523     1537</span></span>
<span><span class="co">#&gt; cor_species[1,6] -0.132 0.181 -0.316  0.055 1.001     2838     3688</span></span>
<span><span class="co">#&gt; cor_species[2,6]  0.008 0.278 -0.281  0.299 1.004     1882     2755</span></span>
<span><span class="co">#&gt; cor_species[3,6]  0.482 0.180  0.293  0.674 1.000     4327     5676</span></span>
<span><span class="co">#&gt; cor_species[4,6] -0.122 0.195 -0.326  0.083 1.000     4415     5681</span></span>
<span><span class="co">#&gt; cor_species[5,6]  0.215 0.175  0.037  0.398 1.000     3173     4339</span></span>
<span><span class="co">#&gt; cor_species[6,6]  1.000 0.000  1.000  1.000 1.000     8082     8023</span></span>
<span><span class="co">#&gt; cor_species[7,6] -0.384 0.174 -0.567 -0.206 1.001     2772     4414</span></span>
<span><span class="co">#&gt; cor_species[8,6]  0.360 0.229  0.130  0.590 1.000     2998     2283</span></span>
<span><span class="co">#&gt; cor_species[1,7] -0.181 0.136 -0.322 -0.039 1.001     2940     4948</span></span>
<span><span class="co">#&gt; cor_species[2,7]  0.108 0.270 -0.166  0.388 1.006     1075     1563</span></span>
<span><span class="co">#&gt; cor_species[3,7] -0.274 0.148 -0.430 -0.120 1.001     3222     5105</span></span>
<span><span class="co">#&gt; cor_species[4,7] -0.191 0.165 -0.361 -0.019 1.001     3249     5112</span></span>
<span><span class="co">#&gt; cor_species[5,7]  0.178 0.118  0.058  0.300 1.000     3952     5534</span></span>
<span><span class="co">#&gt; cor_species[6,7] -0.384 0.174 -0.567 -0.206 1.001     2772     4414</span></span>
<span><span class="co">#&gt; cor_species[7,7]  1.000 0.000  1.000  1.000 1.000     7955     7854</span></span>
<span><span class="co">#&gt; cor_species[8,7]  0.005 0.236 -0.238  0.244 1.003     1676     2538</span></span>
<span><span class="co">#&gt; cor_species[1,8] -0.271 0.247 -0.527 -0.008 1.005     1311     1838</span></span>
<span><span class="co">#&gt; cor_species[2,8]  0.023 0.296 -0.292  0.342 1.001     2945     4908</span></span>
<span><span class="co">#&gt; cor_species[3,8]  0.285 0.230  0.055  0.525 1.000     2342     2024</span></span>
<span><span class="co">#&gt; cor_species[4,8] -0.164 0.243 -0.415  0.085 1.000     3072     2679</span></span>
<span><span class="co">#&gt; cor_species[5,8]  0.217 0.233 -0.014  0.459 1.002     1523     1537</span></span>
<span><span class="co">#&gt; cor_species[6,8]  0.360 0.229  0.130  0.590 1.000     2998     2283</span></span>
<span><span class="co">#&gt; cor_species[7,8]  0.005 0.236 -0.238  0.244 1.003     1676     2538</span></span>
<span><span class="co">#&gt; cor_species[8,8]  1.000 0.000  1.000  1.000 1.000     7976     7302</span></span></code></pre></div>
<p>To get a better overview of the R-hat and effective sample size we
can use the <code>mcmc_plot</code> function to plot histograms of R-hat
and ESS.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"rhat_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"neff_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>We can also examine the output for each parameter visually using a
traceplot combined with a density plot, which is given by the default
<code>plot</code> command:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-9-3.png" width="700"></p>
<pre><code><span><span class="co">#&gt; Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):</span></span>
<span><span class="co">#&gt; collapsing to unique 'x' values</span></span></code></pre>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-9-4.png" width="700"></p>
<p>By default the <code>plot</code> command plots all of the parameters
with sigma or kappa in their name plus a random selection of 20 other
parameters, but this can be overridden by either specifying the
parameters by name (with or without regular expression matching) or
changing the number of parameters to be randomly sampled. Use the
<code>get_parnames</code> function to get the names of parameters within
a model - and the <code>jsdm_stancode</code> function can also be used
to see the underlying structure of the model.</p>
<p>All the mcmc plot types within bayesplot are supported by the
<code>mcmc_plot</code> function, and to see a full list either use
<code><a href="https://mc-stan.org/bayesplot/reference/available_ppc.html" class="external-link">bayesplot::available_mcmc</a></code> or run <code>mcmc_plot</code>
with an incorrect type and the options will be printed.</p>
<p>We can also view the environmental effect parameters for each species
using the <code>envplot</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/envplot.html">envplot</a></span><span class="op">(</span><span class="va">mglmm_fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Posterior predictions can be extracted from the models using either
<code>posterior_linpred</code> or <code>posterior_predict</code>, where
the linpred function extracts the linear predictor for the community
composition within each draw and the predict function combines this
linear predictor extraction with a random generation based on the
predicted probability for the family. Both functions by default return a
list of length equal to the number of draws extracted, where each
element of the list is a sites by species matrix.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mglmm_pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/posterior_predict.jsdmStanFit.html">posterior_predict</a></span><span class="op">(</span><span class="va">mglmm_fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mglmm_pp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mglmm_pp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 60  8</span></span></code></pre></div>
<p>As well as the MCMC plotting functions within bayesplot the ppc_
family of functions is also supported through the <code>pp_check</code>
function. This family of functions provides a graphical way to check
your posterior against the data used within the model to evaluate model
fit - called a posterior retrodictive check (or posterior predictive
historically and when the prior only has been sampled from). To use
these you need to have set <code>save_data = TRUE</code> within the
<code>stan_jsdm</code> call. Unlike in other packages by default
<code>pp_check</code> for <code>jsdmStanFit</code> objects extracts the
posterior predictions then calculates summary statistics over the rows
and plots those summary statistics against the same for the original
data. The default behaviour is to calculate the sum of all the species
per site - i.e.¬†total abundance.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.jsdmStanFit.html">pp_check</a></span><span class="op">(</span><span class="va">mglmm_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 10 posterior draws for ppc plot type 'ppc_dens_overlay' by default.</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>The summary statistic can be changed, as can whether it is calculated
for every species or every site:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pp_check.jsdmStanFit.html">pp_check</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, summary_stat <span class="op">=</span> <span class="st">"mean"</span>, calc_over <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>         plotfun <span class="op">=</span> <span class="st">"ecdf_overlay"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using 10 posterior draws for ppc plot type 'ppc_ecdf_overlay' by default.</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We can examine the species-specific posterior predictive check
through using <code>multi_pp_check</code>, or examine how well the
relationships between specific species are recovered using
<code>pp_check</code> with <code>plotfun = "pairs"</code>.</p>
<p>As we have run the above model on simulated data and the original
data list contains the parameters used to simulate the data we can use
the <code>mcmc_recover_</code> functions from <code>bayesplot</code> to
see how the model did:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"recover_hist"</span>,</span>
<span>          pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sigmas_species["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,<span class="st">"]"</span><span class="op">)</span>,</span>
<span>          true <span class="op">=</span> <span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">pars</span><span class="op">$</span><span class="va">sigmas_species</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">mglmm_fit</span>, plotfun <span class="op">=</span> <span class="st">"recover_intervals"</span>,</span>
<span>          pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"cor_species["</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nspecies</span>, <span class="va">nspecies</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,<span class="st">","</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, <span class="st">":"</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span>,</span>
<span>          true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">pars</span><span class="op">$</span><span class="va">cor_species</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="va">mglmm_test_data</span><span class="op">$</span><span class="va">pars</span><span class="op">$</span><span class="va">cor_species</span>, diag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="fitting-a-gllvm">Fitting a GLLVM<a class="anchor" aria-label="anchor" href="#fitting-a-gllvm"></a>
</h2>
<p>The model fitting workflow for latent variable models is very similar
to that above, with the addition of specifying the number of latent
variables (D) in the data simulation and model fit. We will also specify
a different prior from the default using the <code>jsdm_prior</code>
function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3562251</span><span class="op">)</span></span>
<span><span class="va">gllvm_test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jsdm_sim_data.html">gllvm_sim_data</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">32</span>, S <span class="op">=</span> <span class="fl">7</span>, D <span class="op">=</span> <span class="fl">2</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                                  prior <span class="op">=</span> <span class="fu"><a href="../reference/jsdm_prior.html">jsdm_prior</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="st">"student_t(3,0,1)"</span>,</span>
<span>                                                     sigmas_preds <span class="op">=</span> <span class="st">"student_t(3,0,1)"</span><span class="op">)</span>,</span>
<span>                                  beta_param <span class="op">=</span> <span class="st">"cor"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gllvm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stan_jsdm.html">stan_jsdm</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">gllvm_test_data</span><span class="op">$</span><span class="va">Y</span>, X <span class="op">=</span> <span class="va">gllvm_test_data</span><span class="op">$</span><span class="va">X</span>,</span>
<span>                       D <span class="op">=</span> <span class="va">gllvm_test_data</span><span class="op">$</span><span class="va">D</span>,  </span>
<span>                       family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                       method <span class="op">=</span> <span class="st">"gllvm"</span>, </span>
<span>                       beta_param <span class="op">=</span> <span class="st">"cor"</span>,</span>
<span>                       prior <span class="op">=</span> <span class="fu"><a href="../reference/jsdm_prior.html">jsdm_prior</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="st">"student_t(3,0,1)"</span>,</span>
<span>                                          sigmas_preds <span class="op">=</span> <span class="st">"student_t(3,0,1)"</span><span class="op">)</span>,</span>
<span>                       refresh <span class="op">=</span> <span class="fl">0</span>, log_lik <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trying to compile a simple C file</span></span>
<span><span class="co">#&gt; Running /opt/R/4.4.1/lib/R/bin/R CMD SHLIB foo.c</span></span>
<span><span class="co">#&gt; using C compiler: ‚Äògcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0‚Äô</span></span>
<span><span class="co">#&gt; gcc -I"/opt/R/4.4.1/lib/R/include" -DNDEBUG   -I"/home/runner/work/_temp/Library/Rcpp/include/"  -I"/home/runner/work/_temp/Library/RcppEigen/include/"  -I"/home/runner/work/_temp/Library/RcppEigen/include/unsupported"  -I"/home/runner/work/_temp/Library/BH/include" -I"/home/runner/work/_temp/Library/StanHeaders/include/src/"  -I"/home/runner/work/_temp/Library/StanHeaders/include/"  -I"/home/runner/work/_temp/Library/RcppParallel/include/"  -I"/home/runner/work/_temp/Library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/home/runner/work/_temp/Library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include    -fpic  -g -O2  -c foo.c -o foo.o</span></span>
<span><span class="co">#&gt; In file included from /home/runner/work/_temp/Library/RcppEigen/include/Eigen/Core:19,</span></span>
<span><span class="co">#&gt;                  from /home/runner/work/_temp/Library/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/runner/work/_temp/Library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/runner/work/_temp/Library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: cmath: No such file or directory</span></span>
<span><span class="co">#&gt;   679 | #include &lt;cmath&gt;</span></span>
<span><span class="co">#&gt;       |          ^~~~~~~</span></span>
<span><span class="co">#&gt; compilation terminated.</span></span>
<span><span class="co">#&gt; make: *** [/opt/R/4.4.1/lib/R/etc/Makeconf:195: foo.o] Error 1</span></span>
<span><span class="co">#&gt; Warning: There were 726 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 1963 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</span></span>
<span><span class="co">#&gt; Warning: There were 4 chains where the estimated Bayesian Fraction of Missing Information was low. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bfmi-low</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="va">gllvm_fit</span></span>
<span><span class="co">#&gt; Family: gaussian </span></span>
<span><span class="co">#&gt;  With parameters: sigma,  </span></span>
<span><span class="co">#&gt; Model type: gllvm with 2 latent variables</span></span>
<span><span class="co">#&gt;   Number of species: 7</span></span>
<span><span class="co">#&gt;   Number of sites: 32</span></span>
<span><span class="co">#&gt;   Number of predictors: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model run on 4 chains with 4000 iterations per chain (2000 warmup).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters with Rhat &gt; 1.01, or Neff/N &lt; 0.05:</span></span>
<span><span class="co">#&gt;                 mean     sd      15%     85%  Rhat Bulk.ESS Tail.ESS</span></span>
<span><span class="co">#&gt; z_preds[1,2]   0.260  0.558   -0.256   0.806 1.011      932     2200</span></span>
<span><span class="co">#&gt; sigma[2]       0.129  0.074    0.054   0.209 1.045       70       45</span></span>
<span><span class="co">#&gt; sigma[3]       0.627  0.246    0.354   0.861 1.044       71       70</span></span>
<span><span class="co">#&gt; sigma[6]       0.583  0.322    0.200   0.942 1.077       43       31</span></span>
<span><span class="co">#&gt; sigma[7]       2.567  0.373    2.207   2.940 1.045       66       21</span></span>
<span><span class="co">#&gt; betas[1,2]     0.244  0.384   -0.137   0.642 1.012      677     1951</span></span>
<span><span class="co">#&gt; LV[1,1]       -1.974  0.294   -2.259  -1.682 1.040       86       15</span></span>
<span><span class="co">#&gt; LV[1,3]       -0.029  0.136   -0.169   0.115 1.012      526     1888</span></span>
<span><span class="co">#&gt; LV[1,4]       -0.835  0.182   -1.022  -0.649 1.035      110       25</span></span>
<span><span class="co">#&gt; LV[1,9]       -1.448  0.234   -1.672  -1.217 1.038       92       15</span></span>
<span><span class="co">#&gt; LV[1,11]      -0.720  0.266   -1.006  -0.447 1.024      183     1124</span></span>
<span><span class="co">#&gt; LV[1,12]      -0.466  0.145   -0.613  -0.323 1.028      131       46</span></span>
<span><span class="co">#&gt; LV[1,14]      -0.960  0.252   -1.234  -0.704 1.020      234     1448</span></span>
<span><span class="co">#&gt; LV[1,15]      -1.161  0.240   -1.405  -0.919 1.036      101       18</span></span>
<span><span class="co">#&gt; LV[1,17]      -0.564  0.350   -0.947  -0.201 1.015      341     1272</span></span>
<span><span class="co">#&gt; LV[1,18]       0.102  0.161   -0.054   0.271 1.011      564     1666</span></span>
<span><span class="co">#&gt; LV[1,19]      -0.382  0.397   -0.772   0.026 1.010      414     1282</span></span>
<span><span class="co">#&gt; LV[1,20]      -0.549  0.220   -0.792  -0.329 1.016      294     1320</span></span>
<span><span class="co">#&gt; LV[1,23]      -1.638  0.257   -1.883  -1.385 1.042       82       15</span></span>
<span><span class="co">#&gt; LV[1,26]      -2.733  0.376   -3.094  -2.358 1.039       94       15</span></span>
<span><span class="co">#&gt; LV[1,28]      -0.100  0.131   -0.235   0.028 1.020      303     1828</span></span>
<span><span class="co">#&gt; LV[1,29]      -1.071  0.321   -1.400  -0.746 1.012      494     1107</span></span>
<span><span class="co">#&gt; LV[1,31]      -0.688  0.239   -0.953  -0.450 1.017      279     1670</span></span>
<span><span class="co">#&gt; LV[1,32]       0.111  0.200   -0.082   0.321 1.012      476     1361</span></span>
<span><span class="co">#&gt; LV[2,9]       -0.001  0.477   -0.487   0.529 1.013      327      508</span></span>
<span><span class="co">#&gt; Lambda[1,1]    0.654  0.174    0.478   0.832 1.032       94       18</span></span>
<span><span class="co">#&gt; lp__         -72.850 31.558 -102.769 -42.479 1.059       56       35</span></span></code></pre></div>
<p>Again, the diagnostic statistics seem reasonable:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">gllvm_fit</span>, plotfun <span class="op">=</span> <span class="st">"rhat_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc_plot.jsdmStanFit.html">mcmc_plot</a></span><span class="op">(</span><span class="va">gllvm_fit</span>, plotfun <span class="op">=</span> <span class="st">"neff_hist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>For brevity‚Äôs sake we will not go into the detail of the different
functions again here, however there is one plotting function
specifically for GLLVM models - <code>ordiplot</code>. This plots the
species or sites scores against the latent variables from a random
selection of draws:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">gllvm_fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ordiplot.html">ordiplot</a></span><span class="op">(</span><span class="va">gllvm_fit</span>, type <span class="op">=</span> <span class="st">"sites"</span>, geom <span class="op">=</span> <span class="st">"text"</span>, ndraws <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="jsdmstan-overview_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>You can change the latent variables selected by specifying the
<code>choices</code> argument, and alter the number of draws or whether
you want to plot species or sites with the other arguments.</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>Warton et al (2015) So many variables: joint modeling in community
ecology. Trends in Ecology &amp; Evolution, 30:766-779. DOI: <a href="http:://doi.org/10.1016/j.tree.2015.09.007">10.1016/j.tree.2015.09.007</a>.</p>
<p>Wilkinson et al (2021) Defining and evaluating predictions of joint
species distribution models. Methods in Ecology and Evolution,
12:394-404. DOI: <a href="http:://doi.org/10.1111/2041-210X.13518">10.1111/2041-210X.13518</a>.</p>
<p>Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical Bayesian
model evaluation using leave-one-out cross-validation and WAIC.
Statistics and Computing. 27(5), 1413‚Äì1432. DOI: <a href="http::doi.org/10.1007/s11222-016-9696-4">10.1007/s11222-016-9696-4</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fiona Seaton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
