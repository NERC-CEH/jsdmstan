<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit jsdm models in Stan — stan_jsdm • jsdmstan</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Montserrat-0.4.9/font.css" rel="stylesheet"><link href="../deps/Roboto_Mono-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit jsdm models in Stan — stan_jsdm"><meta name="description" content='This function fits joint Species Distribution models in Stan, using either a
generalised linear latent variable model approach (method = "gllvm"), or a
multivariate generalised linear mixed model approach (method = "mglmm").'><meta property="og:description" content='This function fits joint Species Distribution models in Stan, using either a
generalised linear latent variable model approach (method = "gllvm"), or a
multivariate generalised linear mixed model approach (method = "mglmm").'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">jsdmstan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/jsdmstan-overview.html">Overview</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit jsdm models in Stan</h1>

      <div class="d-none name"><code>stan_jsdm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function fits joint Species Distribution models in Stan, using either a
generalised linear latent variable model approach (<code>method = "gllvm"</code>), or a
multivariate generalised linear mixed model approach (<code>method = "mglmm"</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stan_jsdm</span><span class="op">(</span><span class="va">X</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">stan_jsdm</span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  species_intercept <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">method</span>,</span>
<span>  dat_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">family</span>,</span>
<span>  site_intercept <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  D <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="jsdm_prior.html">jsdm_prior</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  site_groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  beta_param <span class="op">=</span> <span class="st">"unstruct"</span>,</span>
<span>  Ntrials <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  zi_param <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>  zi_X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>  log_lik <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">stan_jsdm</span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>The covariates matrix, with rows being site and columns being covariates.
Ignored in favour of data when formula approach is used to specify model.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code></p></dd>


<dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Matrix of species by sites. Rows are assumed to be sites, columns are
assumed to be species</p></dd>


<dt id="arg-species-intercept">species_intercept<a class="anchor" aria-label="anchor" href="#arg-species-intercept"></a></dt>
<dd><p>Whether the model should be fit with an intercept by
species, by default <code>TRUE</code></p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Whether to fit a GLLVM or MGLMM model, details in description</p></dd>


<dt id="arg-dat-list">dat_list<a class="anchor" aria-label="anchor" href="#arg-dat-list"></a></dt>
<dd><p>Alternatively, data can be given to the model as a list containing
Y, X, N, S, K, and site_intercept. See output of <code><a href="jsdm_sim_data.html">jsdm_sim_data()</a></code> for an
example of how this can be formatted.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>is the response family, must be one of <code>"gaussian"</code>,
<code>"neg_binomial"</code>, <code>"poisson"</code>, <code>"binomial"</code>,
<code>"bernoulli"</code>, or <code>"zi_poisson"</code>. Regular expression
matching is supported.</p></dd>


<dt id="arg-site-intercept">site_intercept<a class="anchor" aria-label="anchor" href="#arg-site-intercept"></a></dt>
<dd><p>Whether a site intercept should be included, potential
values <code>"none"</code> (no site intercept), <code>"grouped"</code> (a site intercept
with hierarchical grouping) or <code>"ungrouped"</code> (site intercept with no
grouping)</p></dd>


<dt id="arg-d">D<a class="anchor" aria-label="anchor" href="#arg-d"></a></dt>
<dd><p>The number of latent variables within a GLLVM model</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>Set of prior specifications from call to <code><a href="jsdm_prior.html">jsdm_prior()</a></code></p></dd>


<dt id="arg-site-groups">site_groups<a class="anchor" aria-label="anchor" href="#arg-site-groups"></a></dt>
<dd><p>If the site intercept is grouped, a vector of group identities
per site</p></dd>


<dt id="arg-beta-param">beta_param<a class="anchor" aria-label="anchor" href="#arg-beta-param"></a></dt>
<dd><p>The parameterisation of the environmental covariate effects, by
default <code>"unstruct"</code>. See details for further information.</p></dd>


<dt id="arg-ntrials">Ntrials<a class="anchor" aria-label="anchor" href="#arg-ntrials"></a></dt>
<dd><p>For the binomial distribution the number of trials, given as
either a single integer which is assumed to be constant across sites or as
a site-length vector of integers.</p></dd>


<dt id="arg-zi-param">zi_param<a class="anchor" aria-label="anchor" href="#arg-zi-param"></a></dt>
<dd><p>For the zero-inflated families, whether the zero-inflation parameter
is a species-specific constant (default, <code>"constant"</code>), or varies by
environmental covariates (<code>"covariate"</code>).</p></dd>


<dt id="arg-zi-x">zi_X<a class="anchor" aria-label="anchor" href="#arg-zi-x"></a></dt>
<dd><p>If <code>zi = "covariate"</code>, the matrix of environmental predictors
that the zero-inflation is modelled in response to. If there is not already
an intercept column (identified by all values being equal to one), one will
be added to the front of the matrix.</p></dd>


<dt id="arg-save-data">save_data<a class="anchor" aria-label="anchor" href="#arg-save-data"></a></dt>
<dd><p>If the data used to fit the model should be saved in the model
object, by default TRUE.</p></dd>


<dt id="arg-iter">iter<a class="anchor" aria-label="anchor" href="#arg-iter"></a></dt>
<dd><p>A positive integer specifying the number of iterations for each chain,
default 4000.</p></dd>


<dt id="arg-log-lik">log_lik<a class="anchor" aria-label="anchor" href="#arg-log-lik"></a></dt>
<dd><p>Whether the log likelihood should be calculated in the generated
quantities (by default TRUE), required for loo</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>The formula of covariates that the species means are modelled from</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Dataframe or list of covariates.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>jsdmStanFit</code> object, comprising a list including the StanFit
object, the data used to fit the model plus a few other bits of information. See
<a href="jsdmStanFit.html">jsdmStanFit</a> for details.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Environmental covariate effects (<code>"betas"</code>) can be parameterised in two
ways. With the <code>"cor"</code> parameterisation all covariate effects are assumed
to be constrained by a correlation matrix between the covariates. With the
<code>"unstruct"</code> parameterisation all covariate effects are assumed to draw
from a simple distribution with no correlation structure. Both parameterisations
can be modified using the prior object.
Families supported are the Gaussian family, the negative binomial family,
the Poisson family, the binomial family (with number of trials specificied
using the <code>Ntrials</code> parameter), the Bernoulli family (the special case
of the binomial family where number of trials is equal to one), the
zero-inflated Poisson and the zero-inflated negative binomial. For both
zero-inflated families the zero-inflation is assumed to be a species-specific
constant.</p>
    </div>
    <div class="section level2">
    <h2 id="methods-by-class-">Methods (by class)<a class="anchor" aria-label="anchor" href="#methods-by-class-"></a></h2>

<ul><li><p><code>stan_jsdm(default)</code>: this is the default way of doing things</p></li>
<li><p><code>stan_jsdm(formula)</code>: Formula interface</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># MGLMM - specified by using the mglmm aliases and with direct reference to Y and</span></span></span>
<span class="r-in"><span><span class="co"># X matrices:</span></span></span>
<span class="r-in"><span><span class="va">mglmm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="jsdm_sim_data.html">mglmm_sim_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  N <span class="op">=</span> <span class="fl">100</span>, S <span class="op">=</span> <span class="fl">10</span>, K <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="st">"gaussian"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mglmm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="stan_mglmm.html">stan_mglmm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  Y <span class="op">=</span> <span class="va">mglmm_data</span><span class="op">$</span><span class="va">Y</span>, X <span class="op">=</span> <span class="va">mglmm_data</span><span class="op">$</span><span class="va">X</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="st">"gaussian"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mglmm_fit</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also run a model by supplying the data as a list:</span></span></span>
<span class="r-in"><span><span class="va">gllvm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="jsdm_sim_data.html">jsdm_sim_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"gllvm"</span>, N <span class="op">=</span> <span class="fl">100</span>, S <span class="op">=</span> <span class="fl">6</span>, D <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="st">"bernoulli"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gllvm_fit</span> <span class="op">&lt;-</span> <span class="fu">stan_jsdm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dat_list <span class="op">=</span> <span class="va">gllvm_data</span>, method <span class="op">=</span> <span class="st">"gllvm"</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="st">"bernoulli"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gllvm_fit</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fiona Seaton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

